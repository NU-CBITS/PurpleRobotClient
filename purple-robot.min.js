function PurpleRobot(a){a=a||{};this.className="PurpleRobot";this._serverUrl=a.serverUrl||"http://localhost:12345/json/submit";this._script=a.script||""}PurpleRobot.apiVersion="1.5.4.0";PurpleRobot.prototype._apiMethod=function(a){return new PurpleRobot({serverUrl:this._serverUrl,script:[this._script,"PurpleRobot."+a+";"].join(" ").trim()})};PurpleRobot.prototype._stringify=function(a){return null!==a&&"object"===typeof a&&a.className===this.className?a.toStringExpression():JSON.stringify(a)};
PurpleRobot.prototype.toString=function(){return this._script};PurpleRobot.prototype.toStringExpression=function(){return"(function() { return "+this._script+" })()"};PurpleRobot.prototype.toJson=function(){return JSON.stringify(this.toString())};
PurpleRobot.prototype.execute=function(a){a=a||{};a.done=a.done||function(){};a.fail=a.fail||function(){};var b=new XMLHttpRequest,c=JSON.stringify({command:"execute_script",script:this.toString()});b.onreadystatechange=function(){b.readyState===XMLHttpRequest.DONE&&(null===b.response?a.fail():a.done(JSON.parse(b.response).payload))};b.open("POST",this._serverUrl,!0);b.setRequestHeader("Content-Type","application/x-www-form-urlencoded");b.send("json="+c)};
PurpleRobot.prototype.save=function(){localStorage.prQueue=localStorage.prQueue||"";localStorage.prQueue+=this.toString();return this};PurpleRobot.prototype.restore=function(){localStorage.prQueue=localStorage.prQueue||"";this._script=localStorage.prQueue;return this};PurpleRobot.prototype.destroy=function(){delete localStorage.prQueue;return this};
PurpleRobot.prototype.isEqual=function(a,b){var c=this._stringify(a)+" == "+this._stringify(b);return new PurpleRobot({serverUrl:this._serverUrl,script:[this._script,c].join(" ").trim()})};PurpleRobot.prototype.ifThenElse=function(a,b,c){return new PurpleRobot({serverUrl:this._serverUrl,script:[this._script,"if ("+a.toString()+") { "+b.toString()+" } else { "+c.toString()+" }"].join(" ").trim()})};
PurpleRobot.prototype.broadcastIntent=function(a,b){throw Error("PurpleRobot.prototype.broadcastIntent not implemented yet");};PurpleRobot.prototype.cancelScriptNotification=function(){return this._apiMethod("cancelScriptNotification()")};PurpleRobot.prototype.dateFromTimestamp=function(a){return this._apiMethod("dateFromTimestamp("+a+")")};PurpleRobot.prototype.disableTrigger=function(a){return this._apiMethod("disableTrigger('"+a+"')")};
PurpleRobot.prototype.emitReading=function(a,b){return this._apiMethod("emitReading('"+a+"', "+JSON.stringify(b)+")")};PurpleRobot.prototype.emitToast=function(a,b){return this._apiMethod("emitToast('"+a+"', "+("boolean"===typeof b?b:!0)+")")};PurpleRobot.prototype.fetchConfig=function(){return this._apiMethod("fetchConfig()")};
PurpleRobot.prototype.fetchEncryptedString=function(a,b){return"undefined"===typeof b?this._apiMethod("fetchEncryptedString('"+a+"')"):this._apiMethod("fetchEncryptedString('"+b+"', '"+a+"')")};PurpleRobot.prototype.fetchNamespace=function(a){throw Error("PurpleRobot.prototype.fetchNamespace not implemented yet");};PurpleRobot.prototype.fetchNamespaces=function(){throw Error("PurpleRobot.prototype.fetchNamespaces not implemented yet");};
PurpleRobot.prototype.fetchSnapshot=function(a){throw Error("PurpleRobot.prototype.fetchSnapshot not implemented yet");};PurpleRobot.prototype.fetchSnapshotIds=function(){throw Error("PurpleRobot.prototype.fetchSnapshotIds not implemented yet");};PurpleRobot.prototype.fetchTrigger=function(a){throw Error("PurpleRobot.prototype.fetchTrigger not implemented yet");};PurpleRobot.prototype.fetchTriggerIds=function(){throw Error("PurpleRobot.prototype.fetchTriggerIds not implemented yet");};
PurpleRobot.prototype.fetchUserId=function(){return this._apiMethod("fetchUserId()")};PurpleRobot.prototype.fetchWidget=function(a){throw Error("PurpleRobot.prototype.fetchWidget not implemented yet");};PurpleRobot.prototype.formatDate=function(a){throw Error("PurpleRobot.prototype.formatDate not implemented yet");};PurpleRobot.prototype.launchApplication=function(a){return this._apiMethod("launchApplication('"+a+"')")};
PurpleRobot.prototype.launchInternalUrl=function(a){throw Error("PurpleRobot.prototype.launchInternalUrl not implemented yet");};PurpleRobot.prototype.launchUrl=function(a){return this._apiMethod("launchUrl('"+a+"')")};PurpleRobot.prototype.loadLibrary=function(a){throw Error("PurpleRobot.prototype.loadLibrary not implemented yet");};PurpleRobot.prototype.log=function(a,b){return this._apiMethod("log('"+a+"', "+JSON.stringify(b)+")")};
PurpleRobot.prototype.models=function(){throw Error("PurpleRobot.prototype.models not implemented yet");};PurpleRobot.prototype.now=function(){throw Error("PurpleRobot.prototype.now not implemented yet");};PurpleRobot.prototype.packageForApplicationName=function(a){throw Error("PurpleRobot.prototype.packageForApplicationName not implemented yet");};PurpleRobot.prototype.parseDate=function(a){throw Error("PurpleRobot.prototype.parseDate not implemented yet");};
PurpleRobot.prototype.persistEncryptedString=function(a,b,c){return"undefined"===typeof c?this._apiMethod("persistEncryptedString('"+a+"', '"+b+"')"):this._apiMethod("persistEncryptedString('"+c+"', '"+a+"', '"+b+"')")};PurpleRobot.prototype.playDefaultTone=function(){return this._apiMethod("playDefaultTone()")};PurpleRobot.prototype.playTone=function(a){return this._apiMethod("playTone('"+a+"')")};
PurpleRobot.prototype.predictions=function(){throw Error("PurpleRobot.prototype.predictions not implemented yet");};PurpleRobot.prototype.readings=function(){throw Error("PurpleRobot.prototype.readings not implemented yet");};PurpleRobot.prototype.readUrl=function(a){return this._apiMethod("readUrl('"+a+"')")};PurpleRobot.prototype.runScript=function(a){return this._apiMethod("runScript("+a.toJson()+")")};
PurpleRobot.prototype.scheduleScript=function(a,b,c){return this._apiMethod("scheduleScript('"+a+"', "+("(function() { var now = new Date(); var scheduled = new Date(now.getTime() + "+b+" * 60000); var pad = function(n) { return n < 10 ? '0' + n : n; }; return '' + scheduled.getFullYear() + pad(scheduled.getMonth() + 1) + pad(scheduled.getDate()) + 'T' + pad(scheduled.getHours()) + pad(scheduled.getMinutes()) + pad(scheduled.getSeconds()); })()")+", "+c.toJson()+")")};
PurpleRobot.prototype.setUserId=function(a){return this._apiMethod("setUserId('"+a+"')")};PurpleRobot.prototype.showApplicationLaunchNotification=function(a,b,c,d,e,f,g){throw Error("PurpleRobot.prototype.showApplicationLaunchNotification not implemented yet");};
PurpleRobot.prototype.showNativeDialog=function(a){var b=a.tag||null,c=a.priority||0;return this._apiMethod("showNativeDialog('"+a.title+"', '"+a.message+"', '"+a.buttonLabelA+"', '"+a.buttonLabelB+"', "+a.scriptA.toJson()+", "+a.scriptB.toJson()+", "+JSON.stringify(b)+", "+c+")")};PurpleRobot.prototype.showScriptNotification=function(a){a=a||{};return this._apiMethod("showScriptNotification('"+a.title+"', '"+a.message+"', "+a.isPersistent+", "+a.isSticky+", "+a.script.toJson()+")")};
PurpleRobot.prototype.updateConfig=function(a){throw Error("PurpleRobot.prototype.updateConfig not implemented yet");};PurpleRobot.prototype.updateTrigger=function(a){a=a||{};var b=(new Date).getTime(),b=a.triggerId||"TRIGGER-"+b;a=JSON.stringify({type:a.type||"datetime",name:b,identifier:b,action:a.script.toString(),datetime_start:a.startAt,datetime_end:a.endAt,datetime_repeat:a.repeatRule||"FREQ=DAILY;INTERVAL=1"});return this._apiMethod("updateTrigger('"+b+"', "+a+")")};
PurpleRobot.prototype.updateWidget=function(a){throw Error("PurpleRobot.prototype.updateWidget not implemented yet");};PurpleRobot.prototype.version=function(){return this._apiMethod("version()")};PurpleRobot.prototype.vibrate=function(a){return this._apiMethod("vibrate('"+(a||"buzz")+"')")};PurpleRobot.prototype.widgets=function(){throw Error("PurpleRobot.prototype.widgets not implemented yet");};
