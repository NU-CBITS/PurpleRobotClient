function PurpleRobot(a){a=a||{};this.className="PurpleRobot";this._serverUrl=a.serverUrl||"http://localhost:12345/json/submit";this._script=a.script||""}var PR=PurpleRobot;function PurpleRobotArgumentException(a,b,c){this.methodName=a;this.argument=b;this.expectedArgument=c;this.message=' received an unexpected argument "';this.toString=function(){return["PurpleRobot.",this.methodName,this.message,this.argument,'" expected: ',this.expectedArgument].join("")}}PR.apiVersion="1.5.4.2";
PR.setEnvironment=function(a){if("production"!==a&&"debug"!==a&&"web"!==a)throw new PurpleRobotArgumentException("setEnvironment",a,'["production", "debug", "web"]');this.env=a;return this};PR.prototype._push=function(a,b){var c=["PurpleRobot.",a,"(",b,");"].join("");return new PR({serverUrl:this._serverUrl,script:[this._script,c].join(" ").trim()})};PR.prototype._stringify=function(a){return null!==a&&"object"===typeof a&&a.className===this.className?a.toStringExpression():JSON.stringify(a)};
PR.prototype.toString=function(){return this._script};PR.prototype.toStringExpression=function(){return"(function() { return "+this._script+" })()"};PR.prototype.toJson=function(){return JSON.stringify(this.toString())};
PR.prototype.execute=function(a){var b=JSON.stringify({command:"execute_script",script:this.toString()});if("web"!==PR.env){var c=new XMLHttpRequest;c.onreadystatechange=function(){a&&c.readyState===XMLHttpRequest.DONE&&(null===c.response?a.fail&&a.fail():a.done&&a.done(JSON.parse(c.response).payload))};c.open("POST",this._serverUrl,!0);c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.send("json="+b)}else console.log('PurpleRobot POSTing to "'+this._serverUrl+'": '+b)};
PR.prototype.save=function(){localStorage.prQueue=localStorage.prQueue||"";localStorage.prQueue+=this.toString();return this};PR.prototype.restore=function(){localStorage.prQueue=localStorage.prQueue||"";this._script=localStorage.prQueue;return this};PR.prototype.destroy=function(){delete localStorage.prQueue;return this};PR.prototype.isEqual=function(a,b){var c=this._stringify(a)+" == "+this._stringify(b);return new PR({serverUrl:this._serverUrl,script:[this._script,c].join(" ").trim()})};
PR.prototype.ifThenElse=function(a,b,c){return new PR({serverUrl:this._serverUrl,script:[this._script,"if ("+a.toString()+") { "+b.toString()+" } else { "+c.toString()+" }"].join(" ").trim()})};PR.prototype.doNothing=function(){return new PR({serverUrl:this._serverUrl,script:this._script})};PR.prototype._q=function(a){return"'"+a+"'"};PR.prototype.addNamespace=function(a){return this._push("addNamespace",""+this._q(a))};
PR.prototype.broadcastIntent=function(a,b){return this._push("broadcastIntent",[this._q(a),JSON.stringify(b||null)].join(", "))};PR.prototype.cancelScriptNotification=function(){return this._push("cancelScriptNotification")};PR.prototype.clearNativeDialogs=function(a){return a?this._push("clearNativeDialogs",this._q(a)):this._push("clearNativeDialogs")};PR.prototype.dateFromTimestamp=function(a){return this._push("dateFromTimestamp",a)};
PR.prototype.disableTrigger=function(a){return this._push("disableTrigger",this._q(a))};PR.prototype.emitReading=function(a,b){return this._push("emitReading",this._q(a)+", "+JSON.stringify(b))};PR.prototype.emitToast=function(a,b){b="boolean"===typeof b?b:!0;return this._push("emitToast",this._q(a)+", "+b)};PR.prototype.fetchConfig=function(){return this._push("fetchConfig")};
PR.prototype.fetchEncryptedString=function(a,b){return"undefined"===typeof b?this._push("fetchEncryptedString",this._q(a)):this._push("fetchEncryptedString",this._q(b)+", "+this._q(a))};PR.prototype.fetchNamespace=function(a){return this._push("fetchNamespace",""+this._q(a))};PR.prototype.fetchNamespaces=function(){return this._push("fetchNamespaces")};PR.prototype.fetchSnapshot=function(a){throw Error("PurpleRobot.prototype.fetchSnapshot not implemented yet");};PR.prototype.fetchSnapshotIds=function(){return this._push("fetchSnapshotIds")};
PR.prototype.fetchTrigger=function(a){return this._push("fetchTrigger",""+this._q(a))};PR.prototype.fetchTriggerIds=function(){return this._push("fetchTriggerIds")};PR.prototype.fetchUserId=function(){return this._push("fetchUserId")};PR.prototype.fetchWidget=function(a){throw Error("PurpleRobot.prototype.fetchWidget not implemented yet");};PR.prototype.formatDate=function(a){throw Error("PurpleRobot.prototype.formatDate not implemented yet");};
PR.prototype.launchApplication=function(a){return this._push("launchApplication",this._q(a))};PR.prototype.launchInternalUrl=function(a){return this._push("launchInternalUrl",""+this._q(a))};PR.prototype.launchUrl=function(a){return this._push("launchUrl",this._q(a))};PR.prototype.loadLibrary=function(a){throw Error("PurpleRobot.prototype.loadLibrary not implemented yet");};PR.prototype.log=function(a,b){return this._push("log",this._q(a)+", "+JSON.stringify(b))};
PR.prototype.models=function(){throw Error("PurpleRobot.prototype.models not implemented yet");};PR.prototype.now=function(){return this._push("now")};PR.prototype.packageForApplicationName=function(a){return this._push("packageForApplicationName",""+this._q(a))};PR.prototype.parseDate=function(a){throw Error("PurpleRobot.prototype.parseDate not implemented yet");};
PR.prototype.persistEncryptedString=function(a,b,c){return"undefined"===typeof c?this._push("persistEncryptedString",this._q(a)+", "+this._q(b)):this._push("persistEncryptedString",this._q(c)+", "+this._q(a)+", "+this._q(b))};PR.prototype.playDefaultTone=function(){return this._push("playDefaultTone")};PR.prototype.playTone=function(a){return this._push("playTone",this._q(a))};PR.prototype.predictions=function(){throw Error("PurpleRobot.prototype.predictions not implemented yet");};
PR.prototype.readings=function(){throw Error("PurpleRobot.prototype.readings not implemented yet");};PR.prototype.readUrl=function(a){return this._push("readUrl",this._q(a))};PR.prototype.runScript=function(a){return this._push("runScript",a.toJson())};
PR.prototype.scheduleScript=function(a,b,c){b="(function() { var now = new Date(); var scheduled = new Date(now.getTime() + "+b+" * 60000); var pad = function(n) { return n < 10 ? '0' + n : n; }; return '' + scheduled.getFullYear() + pad(scheduled.getMonth() + 1) + pad(scheduled.getDate()) + 'T' + pad(scheduled.getHours()) + pad(scheduled.getMinutes()) + pad(scheduled.getSeconds()); })()";return this._push("scheduleScript",this._q(a)+", "+b+", "+c.toJson())};
PR.prototype.setUserId=function(a){return this._push("setUserId",this._q(a))};PR.prototype.showApplicationLaunchNotification=function(a){throw Error("PurpleRobot.prototype.showApplicationLaunchNotification not implemented yet");};PR.prototype.showNativeDialog=function(a){var b=a.tag||null,c=a.priority||0;return this._push("showNativeDialog",[this._q(a.title),this._q(a.message),this._q(a.buttonLabelA),this._q(a.buttonLabelB),a.scriptA.toJson(),a.scriptB.toJson(),JSON.stringify(b),c].join(", "))};
PR.prototype.showScriptNotification=function(a){a=a||{};return this._push("showScriptNotification",[this._q(a.title),this._q(a.message),a.isPersistent,a.isSticky,a.script.toJson()].join(", "))};PR.prototype.updateConfig=function(a){return this._push("updateConfig",""+JSON.stringify(a))};
PR.prototype.updateTrigger=function(a){a=a||{};var b=(new Date).getTime(),b=a.triggerId||"TRIGGER-"+b;a=JSON.stringify({type:a.type||"datetime",name:b,identifier:b,action:a.script.toString(),datetime_start:a.startAt,datetime_end:a.endAt,datetime_repeat:a.repeatRule||"FREQ=DAILY;INTERVAL=1"});return this._push("updateTrigger",this._q(b)+", "+a)};PR.prototype.updateWidget=function(a){throw Error("PurpleRobot.prototype.updateWidget not implemented yet");};PR.prototype.version=function(){return this._push("version")};
PR.prototype.vibrate=function(a){return this._push("vibrate",this._q(a||"buzz"))};PR.prototype.widgets=function(){throw Error("PurpleRobot.prototype.widgets not implemented yet");};
